<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · Jadex</title><meta name="title" content="API · Jadex"/><meta property="og:title" content="API · Jadex"/><meta property="twitter:title" content="API · Jadex"/><meta name="description" content="Documentation for Jadex."/><meta property="og:description" content="Documentation for Jadex."/><meta property="twitter:description" content="Documentation for Jadex."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Jadex</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Jadex</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><a class="tocitem" href="../../userguide/">User Guide</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Interface"><span>Interface</span></a></li><li><a class="tocitem" href="#Wrapper-for-slatec.f"><span>Wrapper for <code>slatec.f</code></span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/autocorr/Jadex.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/autocorr/Jadex.jl/blob/main/docs/src/lib/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="lib_api"><a class="docs-heading-anchor" href="#lib_api">API</a><a id="lib_api-1"></a><a class="docs-heading-anchor-permalink" href="#lib_api" title="Permalink"></a></h1><ul><li><a href="#Jadex.WrapSlateC"><code>Jadex.WrapSlateC</code></a></li></ul><h2 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.EscapeProbability.βlvg-Tuple{Any}" href="#Jadex.EscapeProbability.βlvg-Tuple{Any}"><code>Jadex.EscapeProbability.βlvg</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">βlvg(τ)</code></pre><p>Expanding sphere, Large Velocity Gradient, or Sobolev case. Formula from De Jong, Boland, and Dalgarno (1980, A&amp;A 91, 68)<sup class="footnote-reference"><a id="citeref-DeJong80" href="#footnote-DeJong80">[DeJong80]</a></sup>.  Corrected by a factor of 2 in order to return 1 for τ=0. See Appendix B equation B-7.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/escapeprob.jl#L27-L35">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.EscapeProbability.βslab-Tuple{Any}" href="#Jadex.EscapeProbability.βslab-Tuple{Any}"><code>Jadex.EscapeProbability.βslab</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">βslab(τ)</code></pre><p>Slab geometry (e.g. shocks) with power law approximations from De Jong, Dalgarno, and Chu (1975, ApJ 199, 69)<sup class="footnote-reference"><a id="citeref-DeJong75" href="#footnote-DeJong75">[DeJong75]</a></sup>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/escapeprob.jl#L48-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.EscapeProbability.βsphere-Tuple{Any}" href="#Jadex.EscapeProbability.βsphere-Tuple{Any}"><code>Jadex.EscapeProbability.βsphere</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">βsphere(τ)</code></pre><p>Uniform sphere formula from Osterbrock (Astrophysics of Gaseous Nebulae and Active Galactic Nuclei) Appendix 2 with power law approximations for large and small optical depth.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/escapeprob.jl#L6-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.ReadData.parse_colliders-Tuple{Any, Any, Any}" href="#Jadex.ReadData.parse_colliders-Tuple{Any, Any, Any}"><code>Jadex.ReadData.parse_colliders</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">parse_colliders(lines, levels, transitions)</code></pre><p>Collider collision rate terms are of the form:</p><pre><code class="nohighlight hljs">!NUMBER OF COLL PARTNERS
1
!COLLISIONS BETWEEN
1  HCO+ - H2 from Flower (1999)
!NUMBER OF COLL TRANS
210
!NUMBER OF COLL TEMPS
12
!COLL TEMPS
   10.0   20.0   30.0   50.0   70.0  100.0  150.0  200.0  250.0  300.0  350.0  400.0
!TRANS + UP + LOW + COLLRATES(cm^3 s^-1)
    1     2     1  2.6e-10 2.3e-10 2.1e-10 2.0e-10 1.9e-10 1.8e-10 2.0e-10 2.2e-10 2.3e-10 2.5e-10 2.7e-10 2.8e-10</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/readdata.jl#L167-L186">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.ReadData.parse_energies-Tuple{Any}" href="#Jadex.ReadData.parse_energies-Tuple{Any}"><code>Jadex.ReadData.parse_energies</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">parse_energies(lines)</code></pre><p>Energy level terms begin on the 8th line and are of the form:</p><pre><code class="nohighlight hljs">!LEVEL + ENERGIES(cm^-1) + WEIGHT + J
   1     0.000000000   1.0     0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/readdata.jl#L113-L122">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.ReadData.parse_table-Tuple{Any, Any}" href="#Jadex.ReadData.parse_table-Tuple{Any, Any}"><code>Jadex.ReadData.parse_table</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">parse_table(lines, types)</code></pre><p>Parse a white-space delimited, fixed-width table into a set of columns with known data types.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/readdata.jl#L79-L84">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.ReadData.parse_transitions-Tuple{Any, Jadex.ReadData.EnergyLevels}" href="#Jadex.ReadData.parse_transitions-Tuple{Any, Jadex.ReadData.EnergyLevels}"><code>Jadex.ReadData.parse_transitions</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">parse_transitions(lines, levels::EnergyLevels)</code></pre><p>Transition terms are of the form:</p><pre><code class="nohighlight hljs">!TRANS + UP + LOW + EINSTEINA(s^-1) + FREQ(GHz) + E_u(K)
    1     2     1  4.251e-05          89.18839570     4.28</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/readdata.jl#L137-L146">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.ReadData.Specie-Tuple{AbstractString}" href="#Jadex.ReadData.Specie-Tuple{AbstractString}"><code>Jadex.ReadData.Specie</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">Specie(name::AbstractString; datadir=datadir)</code></pre><p>Parse the LAMDA collision rate file for an atomic or molecular specie from the filename stem (i.e., without the &quot;.dat&quot; file extension). For example, the stem for the <code>&quot;hco+@xpol.dat&quot;</code> file would be <code>&quot;hco+@xpol&quot;</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/readdata.jl#L54-L60">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Background.blackbody_background-Tuple{Any}" href="#Jadex.Background.blackbody_background-Tuple{Any}"><code>Jadex.Background.blackbody_background</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">blackbody_background(xnu; tbg::Real=TCMB)</code></pre><p>Set the background radiation field from a blackbody with a given background temperature. The default temperature is set for the CMB.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/background.jl#L52-L57">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Background.calc_galactic_isrf-Tuple{Any}" href="#Jadex.Background.calc_galactic_isrf-Tuple{Any}"><code>Jadex.Background.calc_galactic_isrf</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">calc_galactic_isrf(xnu; uv_scaling=1.0)</code></pre><p>Galactic interstellar radiation field (ISRF) as parametrized by Hocuk et al. (2017; &quot;H17&quot;) in Appendix B based on Zucconi et al. (2001). Six weighted black-body components are used corresponding to the values in H17 Table B1. The UV component of the ISRF is based on Draine (1978) and added according to the polynomial in H17 Equation B2.</p><p>The angularly-integrated intensity <span>$J_ν$</span> is returned with units of <code>erg / (s cm^2 sr Hz)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/background.jl#L83-L94">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Background.planck-Tuple{Any, Any}" href="#Jadex.Background.planck-Tuple{Any, Any}"><code>Jadex.Background.planck</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">planck(ΔE, tex)</code></pre><p>Planck function to compute black body intensity in <code>[erg / (s cm^2 Hz sr)]</code>.</p><p><strong>Arguments</strong></p><ul><li><code>ΔE</code>: Energy level difference in wavenumber <code>[1/cm]</code>.</li><li><code>tex</code>: Excitation temperature in <code>[K]</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/background.jl#L32-L40">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Background.BackgroundField" href="#Jadex.Background.BackgroundField"><code>Jadex.Background.BackgroundField</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BackgroundField(trj, backi, totalb)</code></pre><p><strong>Arguments</strong></p><ul><li><code>trj</code>: Background brightness temperature <code>[K]</code> in the Rayleigh-Jeans limit.</li><li><code>backi</code>: Background intensity (integrated, <span>$J_ν$</span>) in <code>[erg / (s cm^2 Hz sr)]</code>.</li><li><code>totalb</code>: Total background intensity. Note that because internal radiation           fields are not implemented, <code>totalb</code> should be identical to <code>backi</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/background.jl#L16-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.RunDefinition.get_collision_rates-Union{Tuple{F}, Tuple{Specie{F}, Dict, Real}} where F&lt;:Real" href="#Jadex.RunDefinition.get_collision_rates-Union{Tuple{F}, Tuple{Specie{F}, Dict, Real}} where F&lt;:Real"><code>Jadex.RunDefinition.get_collision_rates</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_collision_rates(mol::Specie, densities::Dict, tkin::Real)</code></pre><p>Interpolate the collision rates for the kinetic temperature and sum over all colliders.</p><p><strong>Returns</strong></p><ul><li><code>crate::Matrix</code>: Collision rate matrix (product of density and rate coeff.).</li><li><code>ctot::Vector</code>: Total collision rate for all transitions to a level.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/rundefinition.jl#L69-L78">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.RunDefinition.thermal_h2_density-Tuple{Any, Any}" href="#Jadex.RunDefinition.thermal_h2_density-Tuple{Any, Any}"><code>Jadex.RunDefinition.thermal_h2_density</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">thermal_h2_density(density, tkin)</code></pre><p>Calculate densities for the ortho (symmetric) and para (anti-symmetric) spin-isomers of molecular hydrogen (H2) from a total molecule density. The ortho-to-para ratio assumes that the H2 was formed in thermal equillibrium at the give kinetic temperature. In the high-temperature limit (&gt; 100 K) the ortho-to-para ratio is 3.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/rundefinition.jl#L150-L158">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.calc_radiation_temperature-NTuple{4, Any}" href="#Jadex.Solver.calc_radiation_temperature-NTuple{4, Any}"><code>Jadex.Solver.calc_radiation_temperature</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">calc_radiation_temperature(xnu, tex, τl, intens_bg)</code></pre><p>Calculate the radiation peak temperature or the background-subtracted line intensity in units of the equivalent radiation temperature in the Rayleigh-Jeans limit. This is equivalent to an observed &quot;main beam&quot; antenna temperature <span>$T_\mathrm{mb}$</span> (antenna temperature corrected for the aperture efficiency, spill-over, and atmospheric opacity) if the emission completely fills the beam (i.e., a beam filling fraction of 1).</p><p class="math-container">\[T_R = \frac{c^2}{2 k \nu^2} \left( I^\mathrm{em}_\nu - I^\mathrm{bg}_\nu \right)\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L510-L523">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.init_radiative!-Tuple{Solution, RunDef}" href="#Jadex.Solver.init_radiative!-Tuple{Solution, RunDef}"><code>Jadex.Solver.init_radiative!</code></a> — <span class="docstring-category">Method</span></header><section><div><p>On the first iteration, use the background intensity to estimate the level populations from optically thin statistical equillibrium. This assumes that the emission is optically thin by setting the escape probability β=1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L118-L123">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.ng_accelerate!-Tuple{Solution}" href="#Jadex.Solver.ng_accelerate!-Tuple{Solution}"><code>Jadex.Solver.ng_accelerate!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ng_accelerate!(sol::Solution)</code></pre><p>Apply Ng-acceleration to level populations from previous three iterations.  See S4.4.7 of &quot;Radiative Transfer in Astrophysics: Theory, Numerical Methods, and Applications&quot; lecture note series by C.P. Dullemond which is itself based on Olson, Auer, and Buchler (1985).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L388-L395">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.solve_rate_eq!-Tuple{Any, Any, Any}" href="#Jadex.Solver.solve_rate_eq!-Tuple{Any, Any, Any}"><code>Jadex.Solver.solve_rate_eq!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">solve_rate_eq!(xpop, yrate, rhs)</code></pre><p>Solve the system of linear equations for the excitation rates to and from each energy level. The result is computed using LU factorization and back-substition on the <code>yrate</code> matrix without pivoting.</p><p>The system of equations <span>$Y x = r$</span> is inverted to <span>$x = Y^{-1} r$</span> and solved, where <span>$Y$</span> (<code>yrate</code>) is the rate matrix encoding the total rate of excitation/dexcitation from one level to another, <span>$x$</span> (<code>xpop</code>) is the level populations, and <span>$r$</span> is the right-hand side (<code>rhs</code>) expressing the time rate-of-change of the level populations. Statistical equillibrium assumes that the derivative <code>rhs</code> term is all zero except for the conservation equation.</p><p><strong>Notes</strong></p><p>These operations correspond to the LU factorization subroutines <code>ludcmp</code> (lower-upper decomposition) and <code>lubksb</code> (lower-upper back substition) Fortran functions in the F77 RADEX source code <code>matrix.f</code> and <code>slatec.f</code>. In practice these subroutines simply prepare (and copy) the arguments for the subroutine <code>SGEIR</code>, which does both the decomposition and solution through back-substitution.  In <code>lubksb</code>, the equation for the last energy level is over-written with the conservation equation (i.e., ones) to make the rate matrix square and non-singular (otherwise the last &quot;column&quot; would be all zeros). This is also done here by over-writing the rates in-place with ones.</p><p>The LU factorization <code>lu!</code> replaces <code>yrate</code> in-place and returns a view. Some work products are still generated with LAPACK/BLAS, but benchmarking shows that these impose negligible overhead.</p><p>A more rigorous factorization would be to include the conservation equation as an additional row and solve the rectangular system of equations <span>$(m+1,m)$</span>. This is also what <code>DESPOTIC</code> does using the non-negative least squares (nnls) solver. Tests with QR factorization and Gaussian elimination however were less numerically stable than LU factorization as well as a factor of a few slower.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L216-L251">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.solve_rate_eq_reduced!-Tuple{Any, Any, Any}" href="#Jadex.Solver.solve_rate_eq_reduced!-Tuple{Any, Any, Any}"><code>Jadex.Solver.solve_rate_eq_reduced!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">solve_rate_eq_reduced!(xpop, yrate, nr)</code></pre><p>Solve the rate equation for a restricted/reduced number of levels. Levels higher than <code>nr</code> are assumed to be optically thin and only coupled by radiative processes. A cascade to levels less than or equal to <code>nr</code> is computed for higher-lying transitions.</p><p>This formalism may not be strictly accurate for complex molecules (e.g., <span>$\mathrm{CH_3OH}$</span>) where many transitions between levels may be radiatively forbidden.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L274-L285">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.step_collision!-Tuple{Solution, RunDef}" href="#Jadex.Solver.step_collision!-Tuple{Solution, RunDef}"><code>Jadex.Solver.step_collision!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">step_collision!(sol::Solution, rdf::RunDef)</code></pre><p>Compute contribution of collisional processes to the rate matrix. Modifies the <code>Solution</code> in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L180-L185">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.step_radiative!-Tuple{Solution, RunDef}" href="#Jadex.Solver.step_radiative!-Tuple{Solution, RunDef}"><code>Jadex.Solver.step_radiative!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">step_radiative!(sol::Solution, rdf::RunDef)</code></pre><p>Compute contribution of radiative processes to the rate matrix using the escape probability. Modifies the <code>Solution</code> in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L142-L147">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.Solver.step_tau_tex!-Tuple{Solution, RunDef}" href="#Jadex.Solver.step_tau_tex!-Tuple{Solution, RunDef}"><code>Jadex.Solver.step_tau_tex!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">step_tau_tex!(sol::Solution, rdf::RunDef)</code></pre><p>Compute the optical depth and excitation temperature for each line.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/solver.jl#L354-L358">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.GridRunner.get_interp-Tuple{AbstractArray{&lt;:Real}, Any}" href="#Jadex.GridRunner.get_interp-Tuple{AbstractArray{&lt;:Real}, Any}"><code>Jadex.GridRunner.get_interp</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_interp(A::Matrix, axes; B=&lt;interpolation-type&gt;)</code></pre><p>Generate a 5D interpolation object for a given τ or Tₑₓ cube where the last dimension indexes the transition number. By default a second order (quadratic) interpolation is used with flat extrapolation for out-of-bounds access. The axis containing the transition number is not interpolated – an exactly matching value must be given.</p><p>Please ensure that the axes passed have a linear step size (nb. use log(n) or log(N) axes if using logarithmically spaced values). A gridded interpolation object can be created using the <code>Gridded</code> interpolation type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/gridded.jl#L137-L149">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.GridRunner.interp_errors-NTuple{4, Any}" href="#Jadex.GridRunner.interp_errors-NTuple{4, Any}"><code>Jadex.GridRunner.interp_errors</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Compare the interpolation to a uniform random sample and return an array of the deviations.</p><p>Note that this implementation currently only works for 5 parameter grids of (n, Tₖ, N, Δv, j) and where <code>n</code> is the volume density of the specified collision partner.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/gridded.jl#L165-L172">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.GridRunner.rungrid-Union{Tuple{I}, Tuple{Specie, AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractVector{I}}} where I&lt;:Integer" href="#Jadex.GridRunner.rungrid-Union{Tuple{I}, Tuple{Specie, AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractVector{I}}} where I&lt;:Integer"><code>Jadex.GridRunner.rungrid</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">rungrid(mol, density, tkin, cdmol, deltav, transitions; ...)</code></pre><p>Generate a grid of τ and Tₑₓ values over the set of physical conditions and selected transitions. Most parameters for a <code>RunDef</code> run definition can be set as keyword arguments (e.g., β, bg). Arguments can be passed as scalars or collections. Runs will be executed in parallel if Julia was started with multiple threads.</p><p>Resulting cubes are indexed with shape <code>(n, Tₖ, N, δv, j)</code> for volume density, kinetic temperature, column density, linewidth, and transition number. The transition index number corresponds to the TRANS value in the LAMDA data file or the index number in the output table.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/gridded.jl#L63-L76">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.GridRunner.runseq-Tuple{Solution, AbstractVector{&lt;:RunDef}}" href="#Jadex.GridRunner.runseq-Tuple{Solution, AbstractVector{&lt;:RunDef}}"><code>Jadex.GridRunner.runseq</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">runseq(sol, rdfs; ...)</code></pre><p>Execute a series model definitions. All <code>RunDef</code> run definitions should be for the same <code>Specie</code> type (i.e., LAMDA file).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/gridded.jl#L27-L32">source</a></section></article><h2 id="Wrapper-for-slatec.f"><a class="docs-heading-anchor" href="#Wrapper-for-slatec.f">Wrapper for <code>slatec.f</code></a><a id="Wrapper-for-slatec.f-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapper-for-slatec.f" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.WrapSlateC" href="#Jadex.WrapSlateC"><code>Jadex.WrapSlateC</code></a> — <span class="docstring-category">Module</span></header><section><div><p><strong>Wrap SLATEC</strong></p><p>Wrap the <code>slatec.f</code> Fortran file distributed as part of RADEX. The <code>slatec.f</code> library is used to solve the system of equations for statistical equillibrium and return the populations for each level. The rate matrix is factored into lower and upper diagonal components (LU decomposition) and solved using partial-pivoting. The subroutines <code>ludcmp</code> (LU decompose) and <code>lubksb</code> (LU back-substition) format the inputs for the main <code>SGEIR</code> subroutine, which itself calls the LINPACK subroutines <code>SGEFA</code> and <code>SGESL</code>.</p><p>The Julia standard library includes LINPACK and uses LU-decomposition with partial-pivoting as the default algorithm for matrix inversion when calling <code>A \ b</code>, thus this module is not necessary but included for the purposes of verifying the output against the exact output of RADEX.</p><p><strong>Usage</strong></p><p>First compile the <code>slatec.f</code> file distributed in the <code>src</code> directory of RADEX into a shared library <code>libslatec.so</code>:</p><pre><code class="language-bash hljs">    gfortran -shared -O2 slatec.f -o libslatec.so -fPIC</code></pre><p>The Fortran standard does not specify how symbol names are expressed in shared libraries and are mangled in different ways by different compilers and even versions of the same compiler. To check, use the <code>nm</code> program to list symbol names from the object file:</p><pre><code class="language-bash hljs">    nm libslatec.so</code></pre><p>Look for entries in the output of <code>nm</code> that are similar to &quot;ludcmp&quot; and &quot;lubksb&quot;. The gfortran compiler typically appends an underscore to the symbol name, thus <code>ludcmp_</code> and <code>lubksb_</code>. If these are not the names, then this file will need to edited to reflect those names, as Julia&#39;s <code>ccall</code> must be given literals for the symbol, library name, output type, and input types (although this could be avoided with a macro that replaces these values at compile time).</p><p>Finally, ensure that the directory containing the library file is included in the shell environment variable <code>LD_LIBRARY_PATH</code>:</p><pre><code class="language-bash hljs">    # Run before starting Julia or include in shell configuration.
    export LD_LIBRARY_PATH=&lt;path-to-lib&gt;:$LD_LIBRARY_PATH
    # Or include when starting Julia.
    LD_LIBRARY_PATH=&lt;path-to-lib&gt; julia</code></pre><p>To use, call the <code>call_slatec!</code> function to modify the <code>rhs</code> level population work array in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/wrap_slatec.jl#L1-L53">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.WrapSlateC.call_slatec!-Tuple{Matrix{Float64}, Vector{Float64}}" href="#Jadex.WrapSlateC.call_slatec!-Tuple{Matrix{Float64}, Vector{Float64}}"><code>Jadex.WrapSlateC.call_slatec!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">call_slatec!(yrate, rhs)</code></pre><p>Solve the system of equations in <code>yrate</code> using LU-decomposition and partial-pivoting to perform the matrix inversion operation <code>yrate \ rhs</code>. The results are stored by modifying the vector <code>rhs</code> in-place. The Fortran routines in RADEX are called natively and included for verification purposes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/wrap_slatec.jl#L59-L66">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jadex.WrapSlateC.solve_rate_eq_slatec!-Tuple{Any, Any, Any}" href="#Jadex.WrapSlateC.solve_rate_eq_slatec!-Tuple{Any, Any, Any}"><code>Jadex.WrapSlateC.solve_rate_eq_slatec!</code></a> — <span class="docstring-category">Method</span></header><section><div><p>For testing results with LU factorization as used by RADEX.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/autocorr/Jadex.jl/blob/54095a5ba23a3a35dd5b2963a0fb5a7029e8e894/src/wrap_slatec.jl#L87">source</a></section></article><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-DeJong80"><a class="tag is-link" href="#citeref-DeJong80">DeJong80</a><a href="https://ui.adsabs.harvard.edu/abs/1980A%26A....91...68D/abstract">ADS abstract</a></li><li class="footnote" id="footnote-DeJong75"><a class="tag is-link" href="#citeref-DeJong75">DeJong75</a><a href="https://ui.adsabs.harvard.edu/abs/1975ApJ...199...69D/abstract">ADS abstract</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../userguide/">« User Guide</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Monday 6 November 2023 22:02">Monday 6 November 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
